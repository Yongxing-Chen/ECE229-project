# ECE229-project: Personalized used car rating & recommendations

Personalized used car rating & recommendations

We use [Pipenv](https://github.com/pypa/pipenv) for dependency management. You will need to have that installed to run any of the commands below. You can install it with
```console
$ pip install --user pipenv
```

## Building the documentation

To build the documentation with `sphinx`, use the command

```console
$ make docgen
```

## Directory structure

```sh
.
├── carsreco # Main module, contains the dashboard code
│   ├── assets # Static assests of the server
│   │   └── ...
│   ├── ...
├── data # Contains the data, created by `make get-data`
│   ├── preprocessed.csv
│   └── vehicles_cleaned_imputed.csv
├── docs/ #containes the documentation generated by `make docgen`
│   └── ...
├── Exploration # contains jupyter notebooks used for data exploration
│   └── wikipedia_exploration.ipynb
├── staticdocs/ #contains the static (non-generated) documentation
│   └── ...
├── tests/ #contains pytest tests
│   └── ...
├── Makefile # contains all recipes for deploying
├── Pipfile # contains dependencies
├── README.md 
└── scripts # contains scripts
    ├── deploy.sh
    └── preprocessing.py
```


## Running locally

*tldr* (will require aws-cli and python-pipenv as well as access to our s3 bucket), run:
```console
$ make run-server
```

For the long version:

### Dependencies

We use [Pipenv](https://github.com/pypa/pipenv) for dependency management.
You will also need the aws command-line to access the dataset stored on S3.

For example on archlinux run
```console
# pacman -S aws-cli python-pipenv
```

Now to get the dependencies, you can run either
```console
$ make deps
```
or simply
```console
$ pipenv install
```

### Data

The dataset (inputed verision) is stored on our S3 bucket. Due to security concerns, we did not
make it public, so you will need to have an aws account with permission to access our S3 bucket.

To get the dataset, and run the preprocessing on it, run:
```console
$ make get-data
```

## Deploying on production

### With github actions (CI/CD)

If you push the code onto the `deploy` branch on github, it will automatically deploy the code
on EC2, using github actions.

### Manually

To deploy on the server, simply run on your local host
(assuming your ssh public key is installed on the EC2 server)

```console
$ make deploy
```
This command reads the environment variables `$SERVER` `$REPO` `$DEPLOYBRANCH` if they are defined.

this will:

- kill any already-running version of the dashboard on the server
- pull the code on the server from the `deploy` branch
- install dependencies on the server (using the `Pipfile`)
- download and preprocess the data on the server
- run the dashboard on the server
